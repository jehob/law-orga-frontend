<!--
  ~ law&orga - record and organization management software for refugee law clinics
  ~ Copyright (C) 2020  Dominik Walser
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>
  -->
<div class="table-entry-information-folder-permission__container">
    <h2>direct folder permissions:</h2>
    <div *ngIf="folderPermissions | async as catalog; else loading">
        <ng-container *ngIf="catalog.length; else noItems">
            <table mat-table [dataSource]="catalog">
                <ng-container matColumnDef="permission">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let folderPermission">
                        <div *ngIf="folderPermission.permission === 'read_folder'; else write_folder">
                            <mat-icon>library_books</mat-icon>
                        </div>
                        <ng-template #write_folder>
                            <div *ngIf="folderPermission === 'write_folder'; else visible">
                                <mat-icon>library_add</mat-icon>
                            </div>
                        </ng-template>
                        <ng-template #visible>
                            <mat-icon>visibility</mat-icon>
                        </ng-template>
                    </td>
                </ng-container>
                <ng-container matColumnDef="group_name">
                    <th mat-header-cell *matHeaderCellDef>name</th>
                    <td mat-cell *matCellDef="let folderPermission">
                        <div *ngIf="folderPermission.id != -1; else general_permission">
                            {{ folderPermission.group.name }}
                        </div>
                        <ng-template #general_permission>general</ng-template>
                    </td>
                </ng-container>
                <ng-container matColumnDef="action">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let folderPermission">
                        <div>
                            <div *ngIf="folderPermission.from === permissionFromChildren; else up">
                                <mat-icon>arrow_downward</mat-icon>
                            </div>
                            <ng-template #up>
                                <div *ngIf="folderPermission.folderId !== folderEntry.id; else delete">
                                    <mat-icon>arrow_upward</mat-icon>
                                </div>
                            </ng-template>
                            <ng-template #delete>
                                <button mat-icon-button (click)="onRemoveFolderPermissionClick(folderPermission)"><mat-icon>delete</mat-icon></button>
                            </ng-template>
                        </div>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="columns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: columns"></tr>
            </table>
        </ng-container>
        <ng-template #noItems>
            <p>there are no special permissions for this folder</p>
        </ng-template>
    </div>
    <ng-template #loading>loading animation...</ng-template>

    <h2>from general permissions: </h2>
    <div *ngIf="folderHasPermissions | async as catalogHas">
        <ng-container *ngIf="catalogHas.length; else noHasItems">
            <table mat-table [dataSource]="catalogHas">
                <ng-container matColumnDef="permission">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let hasPermission">
                        <div *ngIf="hasPermission.permission_id === PERMISSION_READ_ALL_ID; else write_folder">
                            <mat-icon>library_books</mat-icon>
                        </div>
                        <ng-template #write_folder>
                            <div *ngIf="hasPermission.permission_ === PERMISSION_WRITE_ALL_ID; else visible">
                                <mat-icon>library_add</mat-icon>
                            </div>
                        </ng-template>
                        <ng-template #visible>
                            <mat-icon>visibility</mat-icon>
                        </ng-template>
                    </td>
                </ng-container>
                <ng-container matColumnDef="group_name">
                    <th mat-header-cell *matHeaderCellDef>name</th>
                    <td mat-cell *matCellDef="let hasPermission">
                        <div>{{ groups[hasPermission.groupHas].name }}</div>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="columnsHas; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: columnsHas"></tr>
            </table>
        </ng-container>
        <ng-template #noHasItems>
            nothing from general permissions
        </ng-template>
    </div>
    <button
        mat-icon-button
        class="table-entry-information-folder-permission__button"
        (click)="onAddFolderPermissionClick()"
    >
        <mat-icon>add</mat-icon>
    </button>
</div>
