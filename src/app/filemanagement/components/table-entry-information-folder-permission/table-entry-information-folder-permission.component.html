<!--
  ~ law&orga - record and organization management software for refugee law clinics
  ~ Copyright (C) 2020  Dominik Walser
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>
  -->
<div class="table-entry-information-folder-permission__container">
    <h2>direct permissions:</h2>
    <div *ngIf="folderPermissions | async as catalog; else loading">
        <ng-container *ngIf="catalog.length; else noItems">
            <table
                mat-table
                [dataSource]="catalog"
                class="table-entry-information-folder-permission__table"
            >
                <ng-container
                    matColumnDef="permission"
                    class="table-entry-information-folder-permission__table__icon"
                >
                    <th
                        mat-header-cell
                        *matHeaderCellDef
                        class="table-entry-information-folder-permission__table__icon"
                    ></th>
                    <td
                        mat-cell
                        *matCellDef="let folderPermission"
                        class="table-entry-information-folder-permission__table__icon"
                    >
                        <div
                            *ngIf="
                                folderPermission.permission === 'read_folder' &&
                                    folderPermission.from !== permissionFromChildren;
                                else write_folder
                            "
                        >
                            <mat-icon matTooltip="can read folder">library_books</mat-icon>
                        </div>
                        <ng-template #write_folder>
                            <div
                                *ngIf="
                                    folderPermission.permission === 'write_folder' &&
                                        folderPermission.from !== permissionFromChildren;
                                    else visible
                                "
                            >
                                <mat-icon matTooltip="can write folder">library_add</mat-icon>
                            </div>
                        </ng-template>
                        <ng-template #visible>
                            <mat-icon matTooltip="can see folder, but not contents"
                                >visibility</mat-icon
                            >
                        </ng-template>
                    </td>
                </ng-container>
                <ng-container matColumnDef="group_name">
                    <th mat-header-cell *matHeaderCellDef>name</th>
                    <td mat-cell *matCellDef="let folderPermission">
                        <div *ngIf="folderPermission.id != -1; else general_permission">
                            {{ folderPermission.group.name }}
                        </div>
                        <ng-template #general_permission>general</ng-template>
                    </td>
                </ng-container>
                <ng-container matColumnDef="action">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let folderPermission">
                        <div>
                            <div *ngIf="folderPermission.from === permissionFromChildren; else up">
                                <mat-icon
                                    matTooltip="from folder {{ folderPermission.folderName }}"
                                    (click)="onFolderPermissionGoToFolderClick(folderPermission)"
                                    class="is_clickable"
                                    >arrow_downward
                                </mat-icon>
                            </div>
                            <ng-template #up>
                                <div
                                    *ngIf="
                                        folderPermission.folderId !== folderEntry.id;
                                        else delete
                                    "
                                >
                                    <mat-icon
                                        matTooltip="from folder {{ folderPermission.folderName }}"
                                        (click)="
                                            onFolderPermissionGoToFolderClick(folderPermission)
                                        "
                                        class="is_clickable"
                                        >arrow_upward
                                    </mat-icon>
                                </div>
                            </ng-template>
                            <ng-template #delete>
                                <button
                                    mat-icon-button
                                    (click)="onRemoveFolderPermissionClick(folderPermission)"
                                >
                                    <mat-icon matTooltip="delete permission">delete</mat-icon>
                                </button>
                            </ng-template>
                        </div>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="columns; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: columns"></tr>
            </table>
        </ng-container>
        <ng-template #noItems>
            <p>there are no special permissions for this folder</p>
        </ng-template>
    </div>
    <ng-template #loading>loading animation...</ng-template>

    <h2>general permissions:</h2>
    <div *ngIf="folderHasPermissions | async as catalogHas">
        <ng-container *ngIf="catalogHas.length; else noHasItems">
            <table mat-table [dataSource]="catalogHas">
                <ng-container matColumnDef="permission">
                    <th mat-header-cell *matHeaderCellDef></th>
                    <td mat-cell *matCellDef="let hasPermission">
                        <div
                            *ngIf="
                                hasPermission.permission_id === PERMISSION_READ_ALL_ID;
                                else write_folder
                            "
                        >
                            <mat-icon matTooltip="can read all folders">library_books</mat-icon>
                        </div>
                        <ng-template #write_folder>
                            <div
                                *ngIf="
                                    hasPermission.permission_ === PERMISSION_WRITE_ALL_ID;
                                    else visible
                                "
                            >
                                <mat-icon matTooltip="can write in all folders"
                                    >library_add</mat-icon
                                >
                            </div>
                        </ng-template>
                        <ng-template #visible>
                            <mat-icon matTooltip="can see all folders, but not contents"
                                >visibility</mat-icon
                            >
                        </ng-template>
                    </td>
                </ng-container>
                <ng-container matColumnDef="group_name">
                    <th mat-header-cell *matHeaderCellDef>name</th>
                    <td mat-cell *matCellDef="let hasPermission">
                        <div (click)="onGroupClick(hasPermission)" class="is_clickable">
                            {{
                                groups && groups[hasPermission.groupHas]
                                    ? groups[hasPermission.groupHas].name
                                    : ''
                            }}
                        </div>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="columnsHas; sticky: true"></tr>
                <tr mat-row *matRowDef="let row; columns: columnsHas"></tr>
            </table>
        </ng-container>
        <ng-template #noHasItems>
            nothing from general permissions
        </ng-template>
    </div>
    <div class="table-entry-information-folder-permission__add-button-container">
        <button
            mat-icon-button
            class="table-entry-information-folder-permission__button"
            (click)="onAddFolderPermissionClick()"
        >
            <mat-icon>add</mat-icon>
        </button>
    </div>
</div>
