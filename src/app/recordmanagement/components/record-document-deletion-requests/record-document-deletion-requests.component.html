<!--
  ~ law&orga - record and organization management software for refugee law clinics
  ~ Copyright (C) 2019  Dominik Walser
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>
  -->

<div *ngIf="deletionRequests.length > 0; else noRequests">
    <table
        mat-table
        [dataSource]="deletionRequests"
        class="record-document-deletion-requests__table"
    >
        <ng-container matColumnDef="request_from">
            <th mat-header-cell *matHeaderCellDef class="">
                Requestor
            </th>
            <td
                mat-cell
                *matCellDef="let recordDeletionRequest"
                (click)="onUserClick(recordDeletionRequest.request_from)"
                class="is_clickable"
            >
                <p>{{ recordDeletionRequest.request_from.name }}</p>
            </td>
        </ng-container>

        <ng-container matColumnDef="record">
            <th mat-header-cell *matHeaderCellDef>
                Record
            </th>
            <td
                mat-cell
                *matCellDef="let recordDeletionRequest"
                (click)="onRequestClick(recordDeletionRequest)"
                class="is_clickable"
            >
                <p>{{ recordDeletionRequest.record.token }}</p>
            </td>
        </ng-container>
        <ng-container matColumnDef="document">
            <th mat-header-cell *matHeaderCellDef>
                document
            </th>
            <td
                mat-cell
                *matCellDef="let recordDeletionRequest"
                (click)="onRequestClick(recordDeletionRequest)"
            >
                <p>{{ recordDeletionRequest.document.name }}</p>
            </td>
        </ng-container>
        <ng-container matColumnDef="requested">
            <th mat-header-cell *matHeaderCellDef>
                Request date
            </th>
            <td mat-cell *matCellDef="let recordDeletionRequest">
                <p>{{ recordDeletionRequest.requested | date }}</p>
            </td>
        </ng-container>
        <ng-container matColumnDef="state">
            <th mat-header-cell *matHeaderCellDef>
                State
            </th>
            <td mat-cell *matCellDef="let recordDeletionRequest">
                <div [ngSwitch]="recordDeletionRequest.state">
                    <div
                        class="circle-indicator circle-indicator__green"
                        *ngSwitchCase="'gr'"
                        matTooltip="granted"
                    ></div>
                    <div
                        class="circle-indicator circle-indicator__red"
                        *ngSwitchCase="'de'"
                        matTooltip="declined"
                    ></div>
                    <div
                        class="circle-indicator circle-indicator__orange"
                        *ngSwitchCase="'re'"
                        matTooltip="requested"
                    ></div>
                </div>
            </td>
        </ng-container>
        <ng-container matColumnDef="explanation">
            <th mat-header-cell *matHeaderCellDef>explanation</th>
            <td
                mat-cell
                *matCellDef="let recordDeletionRequest"
                [matTooltip]="recordDeletionRequest.explanation"
            >
                {{
                    recordDeletionRequest.explanation !== ''
                        ? recordDeletionRequest.explanation.substring(0, 9) + '...'
                        : '-'
                }}
            </td>
        </ng-container>
        <ng-container matColumnDef="accept">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let recordDeletionRequest">
                <button
                    mat-flat-button
                    color="warn"
                    (click)="declineRequest(recordDeletionRequest)"
                    class="table-action-button-space"
                >
                    Decline
                </button>
                <button
                    mat-flat-button
                    color="primary"
                    (click)="admitRequest(recordDeletionRequest)"
                    class="table-action-button-space"
                >
                    Accept
                </button>
            </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="toProcessColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: toProcessColumns"></tr>
    </table>
</div>
<ng-template #noRequests>
    <p>there are not deletion requests</p>
</ng-template>
