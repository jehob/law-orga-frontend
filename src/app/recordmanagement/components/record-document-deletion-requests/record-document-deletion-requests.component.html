<!--
  ~ law&orga - record and organization management software for refugee law clinics
  ~ Copyright (C) 2019  Dominik Walser
  ~
  ~ This program is free software: you can redistribute it and/or modify
  ~ it under the terms of the GNU Affero General Public License as
  ~ published by the Free Software Foundation, either version 3 of the
  ~ License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful,
  ~ but WITHOUT ANY WARRANTY; without even the implied warranty of
  ~ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  ~ GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License
  ~ along with this program.  If not, see <https://www.gnu.org/licenses/>
  -->

<div *ngIf="deletionRequests.length > 0; else noRequests">
    <h3>To Process</h3>
    <table
        mat-table
        [dataSource]="deletionRequests | baseRequestRequestedPipe"
        class="record-document-deletion-requests__table"
        *ngIf="(deletionRequests | baseRequestRequestedPipe).length > 0; else nothingToProcess"
    >
        <ng-container matColumnDef="request_from">
            <th mat-header-cell *matHeaderCellDef class="">
                Requestor
            </th>
            <td
                mat-cell
                *matCellDef="let recordDocumentDeletionRequest"
                (click)="onUserClick(recordDocumentDeletionRequest.request_from)"
                class="is_clickable"
            >
                <p>{{ recordDocumentDeletionRequest.request_from.name }}</p>
            </td>
        </ng-container>

        <ng-container matColumnDef="record">
            <th mat-header-cell *matHeaderCellDef>
                Record
            </th>
            <td
                mat-cell
                *matCellDef="let recordDocumentDeletionRequest"
                (click)="onRequestClick(recordDocumentDeletionRequest)"
                class="is_clickable"
            >
                <p>{{ recordDocumentDeletionRequest.record.token }}</p>
            </td>
        </ng-container>
        <ng-container matColumnDef="document">
            <th mat-header-cell *matHeaderCellDef>
                document
            </th>
            <td
                mat-cell
                *matCellDef="let recordDocumentDeletionRequest"
                (click)="onRequestClick(recordDocumentDeletionRequest)"
            >
                <p>{{ recordDocumentDeletionRequest.document.name }}</p>
            </td>
        </ng-container>
        <ng-container matColumnDef="requested">
            <th mat-header-cell *matHeaderCellDef>
                Request date
            </th>
            <td mat-cell *matCellDef="let recordDocumentDeletionRequest">
                <p>{{ recordDocumentDeletionRequest.requested | date }}</p>
            </td>
        </ng-container>
        <ng-container matColumnDef="explanation">
            <th mat-header-cell *matHeaderCellDef>explanation</th>
            <td
                mat-cell
                *matCellDef="let recordDocumentDeletionRequest"
                [matTooltip]="recordDocumentDeletionRequest.explanation"
            >
                {{
                    recordDocumentDeletionRequest.explanation !== ''
                        ? recordDocumentDeletionRequest.explanation.substring(0, 9) + '...'
                        : '-'
                }}
            </td>
        </ng-container>
        <ng-container matColumnDef="accept">
            <th mat-header-cell *matHeaderCellDef></th>
            <td mat-cell *matCellDef="let recordDocumentDeletionRequest">
                <button
                    mat-flat-button
                    color="warn"
                    (click)="declineRequest(recordDocumentDeletionRequest)"
                    class="table-action-button-space"
                >
                    Decline
                </button>
                <button
                    mat-flat-button
                    color="primary"
                    (click)="admitRequest(recordDocumentDeletionRequest)"
                    class="table-action-button-space"
                >
                    Accept
                </button>
            </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="toProcessColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: toProcessColumns"></tr>
    </table>

    <ng-template #nothingToProcess>
        <p>nothing to process</p>
    </ng-template>
    <h3>Already Processed</h3>
    <table
        mat-table
        [dataSource]="deletionRequests | baseRequestProcessedPipe"
        class="record-document-deletion-requests__table"
    >
        <ng-container matColumnDef="request_from">
            <th mat-header-cell *matHeaderCellDef>
                Requestor
            </th>
            <td
                mat-cell
                *matCellDef="let recordDocumentDeletionRequest"
                (click)="onUserClick(recordDocumentDeletionRequest.request_from)"
                class="is_clickable"
            >
                <p>{{ recordDocumentDeletionRequest.request_from.name }}</p>
            </td>
        </ng-container>
        <ng-container matColumnDef="record">
            <th mat-header-cell *matHeaderCellDef>
                Record
            </th>
            <td
                mat-cell
                *matCellDef="let recordDocumentDeletionRequest"
                (click)="onRequestClick(recordDocumentDeletionRequest)"
                class="is_clickable"
            >
                <p>{{ recordDocumentDeletionRequest.record.token }}</p>
            </td>
        </ng-container>
        <ng-container matColumnDef="requested">
            <th mat-header-cell *matHeaderCellDef>
                Request Date
            </th>
            <td mat-cell *matCellDef="let recordDocumentDeletionRequest">
                <p>{{ recordDocumentDeletionRequest.requested | date }}</p>
            </td>
        </ng-container>
        <ng-container matColumnDef="state">
            <th mat-header-cell *matHeaderCellDef>
                State
            </th>
            <td mat-cell *matCellDef="let recordDocumentDeletionRequest">
                <div [ngSwitch]="recordDocumentDeletionRequest.state">
                    <div
                        class="circle-indicator circle-indicator__red"
                        *ngSwitchCase="stateDeclined"
                        matTooltip="declined"
                    ></div>
                    <div
                        class="circle-indicator circle-indicator__green"
                        *ngSwitchCase="stateAccepted"
                        matTooltip="accepted"
                    ></div>
                </div>
            </td>
        </ng-container>
        <ng-container matColumnDef="processor">
            <th mat-header-cell *matHeaderCellDef>
                Processor
            </th>
            <td
                mat-cell
                *matCellDef="let recordDocumentDeletionRequest"
                [class.is_clickable]="recordDocumentDeletionRequest.request_processed.id != -1"
                (click)="onUserClick(recordDocumentDeletionRequest.request_processed)"
            >
                <p>{{ recordDocumentDeletionRequest.request_processed.name }}</p>
            </td>
        </ng-container>
        <ng-container matColumnDef="processed_on">
            <th
                mat-header-cell
                *matHeaderCellDef
                class="records-deletion-requests__to-process-column__header"
            >
                Process date
            </th>
            <td mat-cell *matCellDef="let recordDocumentDeletionRequest">
                <p>{{ recordDocumentDeletionRequest.processed_on | date }}</p>
            </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="alreadyProcessedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let row; columns: alreadyProcessedColumns"></tr>
    </table>
</div>

<ng-template #noRequests>
    <p>there are no deletion requests</p>
</ng-template>
